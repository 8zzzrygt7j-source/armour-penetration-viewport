<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Armour Penetration Simulator</title>
<style>
  body { margin:0; overflow:hidden; background:black; }
  #ui {
    position:absolute;
    top:10px; left:10px;
    font-family: monospace;
    color:white;
    z-index:10;
  }
</style>
</head>
<body>

<div id="ui">
ANGLE: <span id="ang">30</span>Â°<br>
<input type="range" id="angle" min="0" max="75" value="30"><br><br>
<button onclick="fire()">FIRE</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/* ---------- SCENE ---------- */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 100);
camera.position.set(0, 0.5, 5);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

/* ---------- LIGHT ---------- */
scene.add(new THREE.AmbientLight(0x555555));
const light = new THREE.DirectionalLight(0xffffff, 1.2);
light.position.set(5,5,5);
scene.add(light);

/* ---------- ARMOUR TEXTURE ---------- */
const canvas = document.createElement("canvas");
canvas.width = canvas.height = 256;
const ctx = canvas.getContext("2d");

ctx.fillStyle = "#2b3f7a";
ctx.fillRect(0,0,256,256);
for(let i=0;i<3000;i++){
  const x=Math.random()*256,y=Math.random()*256;
  const v=40+Math.random()*40;
  ctx.fillStyle=`rgb(${v},${v},${v})`;
  ctx.fillRect(x,y,1,1);
}
const armourTexture = new THREE.CanvasTexture(canvas);

/* ---------- ARMOUR ---------- */
const armourGeo = new THREE.PlaneGeometry(3,1.5,30,15);
const armourMat = new THREE.MeshStandardMaterial({
  map: armourTexture,
  metalness: 0.8,
  roughness: 0.4
});
const armour = new THREE.Mesh(armourGeo, armourMat);
scene.add(armour);

/* ---------- SHELL ---------- */
const shellGeo = new THREE.SphereGeometry(0.06,16,16);
const shellMat = new THREE.MeshStandardMaterial({
  color: 0xffaa00,
  emissive: 0x552200
});
const shell = new THREE.Mesh(shellGeo, shellMat);
scene.add(shell);

let velocity = new THREE.Vector3();
let flying = false;

/* ---------- UI ---------- */
const slider = document.getElementById("angle");
const angText = document.getElementById("ang");
slider.oninput = () => angText.textContent = slider.value;

/* ---------- FIRE ---------- */
function fire(){
  shell.position.set(-3,0,0);
  shell.scale.set(1,1,1);
  const a = THREE.MathUtils.degToRad(slider.value);
  velocity.set(Math.cos(a)*0.25, Math.sin(a)*0.1, 0);
  flying = true;
}

/* ---------- IMPACT ---------- */
function deformArmour(point){
  const pos = armour.geometry.attributes.position;
  for(let i=0;i<pos.count;i++){
    const dx = pos.getX(i)-point.x;
    const dy = pos.getY(i)-point.y;
    const d = Math.sqrt(dx*dx+dy*dy);
    if(d < 0.25){
      pos.setZ(i, -0.15*(1-d/0.25));
    }
  }
  pos.needsUpdate = true;
}

/* ---------- LOOP ---------- */
function animate(){
  requestAnimationFrame(animate);

  if(flying){
    shell.position.add(velocity);
    if(shell.position.x > 0){
      flying = false;
      deformArmour(shell.position);
      shell.scale.set(1.3,0.6,1.3);
    }
  }

  renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
