<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pzgr.39 X-Ray Penetration</title>
<style>
  body { margin:0; overflow:hidden; background:black; }
  #ui {
    position:absolute;
    top:10px; left:10px;
    font-family: monospace;
    color:white;
    z-index:10;
  }
</style>
</head>
<body>

<div id="ui">
Pzgr.39 â€“ X-RAY TEST<br>
<button onclick="fire()">FIRE</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/* ---------- SCENE ---------- */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(55, innerWidth/innerHeight, 0.1, 100);
camera.position.set(0, 0.25, 4);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

/* ---------- LIGHT ---------- */
scene.add(new THREE.AmbientLight(0x666666));
const key = new THREE.DirectionalLight(0xffffff, 2.2);
key.position.set(5,4,3);
scene.add(key);

/* ---------- ARMOUR ---------- */
const armourGeo = new THREE.BoxGeometry(0.5, 1.8, 2.8, 12, 20, 12);
const armourMat = new THREE.MeshStandardMaterial({
  color: 0x3a4d88,
  metalness: 0.9,
  roughness: 0.35,
  transparent: true,
  opacity: 0.55
});
const armour = new THREE.Mesh(armourGeo, armourMat);
scene.add(armour);

/* ---------- Pzgr.39 SHELL ---------- */
const shell = new THREE.Group();

// Penetration cap (blunt)
const capGeo = new THREE.SphereGeometry(0.055, 16, 12);
const capMat = new THREE.MeshStandardMaterial({ color:0x666666 });
const cap = new THREE.Mesh(capGeo, capMat);
cap.scale.z = 0.6;
cap.position.x = 0.32;
shell.add(cap);

// Shell body (long steel rod)
const bodyGeo = new THREE.CylinderGeometry(0.05,0.05,0.65,20);
const bodyMat = new THREE.MeshStandardMaterial({ color:0x777777 });
const body = new THREE.Mesh(bodyGeo, bodyMat);
body.rotation.z = Math.PI/2;
shell.add(body);

// Base (tracer / base plug)
const baseGeo = new THREE.CylinderGeometry(0.045,0.045,0.12,12);
const baseMat = new THREE.MeshStandardMaterial({ color:0x555555 });
const base = new THREE.Mesh(baseGeo, baseMat);
base.rotation.z = Math.PI/2;
base.position.x = -0.38;
shell.add(base);

scene.add(shell);

/* ---------- STATE ---------- */
let velocity = new THREE.Vector3();
let flying = false;
let crushed = false;

/* ---------- FIRE ---------- */
function fire(){
  shell.position.set(-3,0,0);
  shell.scale.set(1,1,1);
  shell.rotation.set(0,0,0);
  velocity.set(0.06,0,0); // full slow-mo
  flying = true;
  crushed = false;
}

/* ---------- ARMOUR DEFORMATION ---------- */
function deformArmour(point){
  const pos = armour.geometry.attributes.position;
  for(let i=0;i<pos.count;i++){
    const dx = pos.getX(i)-point.x;
    const dy = pos.getY(i)-point.y;
    const dz = pos.getZ(i)-point.z;
    const d = Math.sqrt(dx*dx+dy*dy+dz*dz);
    if(d < 0.5){
      pos.setX(i, pos.getX(i)-0.35*(1-d/0.5));
    }
  }
  pos.needsUpdate = true;
}

/* ---------- SHELL DEFORMATION (BRUTAL) ---------- */
function crushShell(){
  // Cap pancakes
  cap.scale.set(1.8,1.8,0.25);
  cap.position.x -= 0.05;

  // Body buckles
  body.scale.set(1.4,0.85,1.4);
  body.position.x -= 0.08;

  // Base shortens
  base.scale.set(1,1,0.6);
  base.position.x += 0.04;

  // Entire shell shortens
  shell.scale.x = 0.75;

  crushed = true;
}

/* ---------- LOOP ---------- */
function animate(){
  requestAnimationFrame(animate);

  if(flying){
    shell.position.add(velocity);
    shell.rotation.x += 0.08;

    // impact
    if(shell.position.x >= -0.25 && !crushed){
      deformArmour(shell.position);
      crushShell();
    }

    // stop inside armour
    if(shell.position.x >= 0.35){
      flying = false;
    }
  }

  renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
